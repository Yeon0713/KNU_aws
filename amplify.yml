version: 1
applications:
  - appRoot: knu_flutter_app
    frontend:
      phases:
        preBuild:
          commands:
            # Simple Flutter installation without complex debugging
            - |
              echo "=== Flutter 설치 시작 ==="
              
              # Clean start
              rm -rf flutter ~/.pub-cache
              
              # Download Flutter
              echo "Flutter 다운로드..."
              wget -q -O flutter.tar.xz https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.16.0-stable.tar.xz
              
              # Extract using Python (most reliable method)
              echo "Flutter 압축 해제..."
              python3 -c "import lzma, tarfile; f=lzma.open('flutter.tar.xz','rb'); t=open('flutter.tar','wb'); t.write(f.read()); f.close(); t.close(); tarfile.open('flutter.tar').extractall()"
              rm -f flutter.tar.xz flutter.tar
              
              # Verify Flutter installation
              if [ ! -f "flutter/bin/flutter" ]; then
                echo "❌ Flutter 설치 실패"
                exit 1
              fi
              
              echo "✅ Flutter 설치 완료"
              
        build:
          commands:
            # Simple Flutter web build
            - |
              echo "=== Flutter 웹 빌드 시작 ==="
              
              # Set Flutter path
              export PATH="$PWD/flutter/bin:$PATH"
              
              # Enable web support
              flutter config --enable-web --no-analytics
              
              # Get dependencies
              flutter pub get
              
              # Build for web
              flutter build web --release
              
              # Verify build output
              if [ ! -f "build/web/index.html" ]; then
                echo "❌ 웹 빌드 실패"
                ls -la build/ || echo "build 디렉토리 없음"
                exit 1
              fi
              
              echo "✅ 웹 빌드 성공"
              ls -la build/web/
              
      artifacts:
        baseDirectory: build/web
        files:
          - '**/*'
      cache:
        paths: []